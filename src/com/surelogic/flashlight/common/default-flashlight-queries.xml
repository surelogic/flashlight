<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<ad-hoc version='3.0'>
  <query id='29b5a2b5-671d-4721-94bb-9552cda1c77d' description='A new query' revision='0'>SELECT * FROM LOCK</query>
  <query id='6a39e6ca-29e9-4093-ba03-0e9bd9503a1a' description='How often is a lock held when this field is accessed?' revision='3' display='true'>SELECT LOCKS.*, (CAST (LOCKS.LOCKCOUNT AS FLOAT)) / (CAST (ACCESSES.ACCESSCOUNT AS FLOAT))
FROM
(SELECT D.Lock &quot;LOCK&quot;,COUNT(D.Lock) &quot;LOCKCOUNT&quot;
 FROM ACCESS A
      INNER JOIN LOCKDURATION D ON D.InThread = A.InThread AND D.Start &lt; A.TS AND D.Stop &gt; A.TS AND State = &apos;HOLDING&apos; 
    WHERE A.FIELD = ?FieldId? AND A.RECEIVER IS NULL
 GROUP BY D.LOCK) AS LOCKS,
(SELECT COUNT(*) &quot;ACCESSCOUNT&quot; FROM ACCESS A WHERE A.FIELD = ?FieldId? AND A.RECEIVER IS NULL) AS ACCESSES</query>
  <query id='a1e89392-cd0c-4a41-85f1-44251d7a5e71' description='How often is a lock held when this field is accessed? ' revision='3' display='true'>SELECT LOCKS.*, CAST ((CAST (LOCKS.&quot;Lock Count&quot; AS FLOAT)) / (CAST (ACCESSES.ACCESSCOUNT AS FLOAT)) AS DECIMAL (4,3)) &quot;Frequency&quot;
FROM
(SELECT D.Lock &quot;Lock&quot;, COUNT(D.Lock) &quot;Lock Count&quot;
 FROM ACCESS A
      INNER JOIN LOCKDURATION D ON D.InThread = A.InThread AND D.Start &lt; A.TS AND D.Stop &gt; A.TS AND State = &apos;HOLDING&apos; 
    WHERE A.FIELD = ?FieldId? AND A.RECEIVER = ?Receiver?
 GROUP BY D.LOCK) AS LOCKS,
(SELECT COUNT(*) &quot;ACCESSCOUNT&quot; FROM ACCESS A WHERE A.FIELD = ?FieldId? AND A.RECEIVER = ?Receiver?) AS ACCESSES</query>
  <query id='e353c660-c044-43c3-8f29-df5edb359d2d' description='Show Tables' revision='0'>select st.TABLENAME &quot;Table&quot;,sco.columnname &quot;COLUMN__|&quot;,sco.columndatatype,sco.autoincrementvalue,sco.autoincrementstart,sco.autoincrementinc
   from sys.sysschemas sc,sys.systables st,sys.syscolumns sco 
   where sc.schemaname = &apos;FLASHLIGHT&apos; and st.schemaid = sc.schemaid and sco.referenceid = st.tableid 
   order by st.tablename,sco.columnnumber</query>
  <query id='4fce8390-7307-45dc-b779-5701ee7f23a1' description='Show the lock events for a lock graph edge' revision='0' display='true'>select lo.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, lo.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, s.AtLine &quot;Line__]&quot;, tho.ThreadName &quot;Thread__|&quot;, lh.LockEvent &quot;LockEvent__(r)&quot;
from LOCKSHELD as lh, LOCK l, TRACE tr, SITE s, OBJECT lo, OBJECT tho
where lh.LockHeld=?LockHeld?
  and lh.LockAcquired=?LockAcquired?
  and lh.LockEvent=l.Id
  and tr.Id = l.Trace
  and s.Id = tr.Site
  and lo.Id = s.InClass
  and tho.Id = l.InThread
order by lo.PackageName,lo.ClassName, s.AtLine, tho.ThreadName, lh.LockEvent
  </query>
  <query id='b82d393a-0d04-4daf-9716-1d88047e2585' description='What fields (non-static) are shared? ' revision='2' display='true' display-at-root='true'>select
  O.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  O.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;,
  F.FieldName &quot;FieldName__]&quot;,
  FI.Receiver &quot;Receiver&quot;,
  THO.ThreadName &quot;Thread__|&quot;,
  FI.ReadUCCount + FI.ReadCount &quot;Reads__(sum on 3,4)(r)&quot;,
  FI.WriteUCCount + FI.WriteCount &quot;Writes__(sum on 3,4)(r)&quot;,
  FI.ReadUCCount &quot;Reads During Construction__(sum on 3,4)(r)&quot;,
  FI.WriteUCCount &quot;Writes During Construction__(sum on 3,4)(r)&quot;,
  F.ID &quot;FieldId__(hide)&quot;
from OBJECT O,
     FIELD F,
     FIELDINSTANCETHREAD FI,
     OBJECT THO
where
  F.DeclaringType = O.Id
  and FI.FIELD = F.ID 
  and THO.ID = FI.Thread
order by O.PackageName,O.ClassName,F.FieldName,FI.Receiver,THO.ThreadName</query>
  <query id='adbe7424-776f-4903-86e2-a0f38f69c7f5' description='What fields (non-static) have a lock set? ' revision='2' display='true' display-at-root='true'>SELECT 
  O.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  O.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;,
  FI.FieldName &quot;FieldName__]&quot;,
  I.RECEIVER &quot;Receiver&quot;, F.LOCK &quot;Lock__|&quot;, I.FIELD &quot;FieldId__(hide)&quot;
 FROM OBJECT O
 INNER JOIN FIELD FI ON FI.DeclaringType = O.Id
 INNER JOIN INTERESTINGFIELD I ON FI.STATIC = &apos;N&apos; AND I.FIELD=FI.ID
 INNER JOIN FIELDINSTANCELOCKSET F ON F.FIELD = I.FIELD AND F.RECEIVER = I.RECEIVER 
 ORDER BY O.PackageName,O.ClassName,FI.FieldName,I.Receiver</query>
  <query id='7eabaf47-9614-400f-bb4e-fd9e0f13e793' description='What fields (non-static) have an empty lock set?' revision='2' display='true' display-at-root='true'>SELECT 
  O.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  O.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;,
  FI.FieldName &quot;FieldName__]&quot;,
  I.RECEIVER &quot;Receiver__|&quot;,I.FIELD &quot;FieldId__(hide)&quot;
 FROM OBJECT O
 INNER JOIN FIELD FI ON FI.DeclaringType = O.Id
 INNER JOIN INTERESTINGFIELD I ON FI.STATIC = &apos;N&apos; AND I.FIELD=FI.ID
 LEFT OUTER JOIN FIELDINSTANCELOCKSET F ON F.FIELD = I.FIELD AND F.RECEIVER = I.RECEIVER 
 WHERE F.LOCK IS NULL
 ORDER BY O.PackageName, O.ClassName, FI.FieldName</query>
  <query id='419c927e-a87c-4364-b4a9-2e8f50f728f6' description='What fields (static) are shared?' revision='2' display='true' display-at-root='true'>select
  O.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  O.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;,
  F.FieldName &quot;FieldName__]&quot;,
  THO.ThreadName &quot;Thread__|&quot;,
  FS.ReadCount &quot;Read Count__(sum on 3)(r)&quot;,
  FS.WriteCount &quot;Write Count__(sum on 3)(r)&quot;,
  F.ID &quot;FieldId__(hide)&quot;
from OBJECT O,
     FIELD F,
     FIELDSTATICTHREAD FS,
     OBJECT THO
where
  F.DeclaringType = O.Id
  and FS.FIELD = F.ID 
  and THO.ID = FS.Thread
order by O.PackageName,O.ClassName,F.FieldName,THO.ThreadName</query>
  <query id='2f505921-50fb-405b-bc78-4a5fe9228957' description='What fields (static) have a lock set? ' revision='2' display='true' display-at-root='true'>SELECT 
  O.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  O.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;,
  FI.FieldName &quot;FieldName&quot;,
  F.LOCK &quot;Lock__|&quot;,
  I.FIELD &quot;FieldId__(hide)&quot; 
 FROM OBJECT O
 INNER JOIN FIELD FI ON FI.DeclaringType = O.Id
 INNER JOIN INTERESTINGFIELD I ON I.RECEIVER IS NULL AND I.FIELD=FI.ID
 INNER JOIN FIELDLOCKSET F ON F.FIELD = I.FIELD
 ORDER BY O.PackageName,O.ClassName,FI.FieldName</query>
  <query id='c744b5b5-15f0-4f72-a344-7e52bcac5071' description='What fields (static) have an empty lock set?' revision='2' display='true' display-at-root='true'>SELECT 
  O.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  O.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;,
  FI.FieldName &quot;FieldName__|&quot;,
  I.FIELD &quot;FieldId__(hide)&quot;
 FROM OBJECT O
 INNER JOIN FIELD FI ON FI.DeclaringType = O.Id
 INNER JOIN INTERESTINGFIELD I ON I.RECEIVER IS NULL AND I.FIELD=FI.ID
 LEFT OUTER JOIN FIELDLOCKSET F ON F.FIELD = I.FIELD
 WHERE F.LOCK IS NULL
 ORDER BY O.PackageName,O.ClassName,FI.FieldName</query>
  <query id='fb317a0c-d9c5-41e2-811b-d6236f63fae1' description='What is the lock trace for this lock event?' revision='1' display='true'>SELECT D.Lock &quot;Lock__(r)&quot;, LO.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, LO.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, S.AtLine &quot;Line__(r)&quot;, D.Start &quot;Time&quot;
FROM LOCK L
 INNER JOIN LOCKDURATION D ON
   D.InThread = L.InThread AND 
   L.TS &gt;= D.Start AND
   L.TS &lt; D.Stop
 INNER JOIN LOCK LL ON
   LL.Id = D.StartEvent
 INNER JOIN TRACE T ON
   T.ID = LL.TRACE
 INNER JOIN SITE S ON
   S.ID = T.SITE
 INNER JOIN OBJECT LO ON
   LO.ID = S.InClass
WHERE L.Id = ?LockEvent?
ORDER BY D.START DESC</query>
  <query id='83d613b3-283e-4100-9a82-e42adf107fe6' description='What is the stack trace for this field access?' revision='1' display='true'>SELECT s.PACKAGENAME &quot;Package__(&apos;package.gif&apos;)&quot;, s.CLASSNAME &quot;Class__(&apos;class.gif&apos;)&quot;, s.INFILE &quot;File&quot;, s.LOCATION &quot;Location&quot;, s.ATLINE &quot;Line__(r)&quot;
FROM TABLE (STACKTRACE(?ATRACE?)) s
</query>
  <query id='10477928-cf86-4416-9118-34eea8cd7e38' description='What is the stack trace for this lock acquisition?' revision='1' display='true'>SELECT s.PACKAGENAME &quot;Package__(&apos;package.gif&apos;)&quot;, s.CLASSNAME &quot;Class__(&apos;class.gif&apos;)&quot;, s.INFILE &quot;File&quot;, s.LOCATION &quot;Location&quot;, s.ATLINE &quot;Line__(r)&quot;
FROM TABLE (STACKTRACE(?LATRACE?)) s
</query>
  <query id='432b76db-c751-4bd8-8b2f-ef5986334514' description='What is the stack trace for this lock event?' revision='1' display='true'>SELECT s.PACKAGENAME &quot;Package__(&apos;package.gif&apos;)&quot;, s.CLASSNAME &quot;Class__(&apos;class.gif&apos;)&quot;, s.INFILE &quot;File&quot;, s.LOCATION &quot;Location&quot;, s.ATLINE &quot;Line__(r)&quot;
FROM TABLE (STACKTRACE(?LETRACE?)) s</query>
  <query id='cb38a427-c259-4690-abe2-acea9661f737' description='What locks are contended for the longest time?' revision='0' display='true' display-at-root='true'>select Lock &quot;Lock__(c)&quot;, (trim (cast(sum(Duration) as char(20)))) || &apos; ns&apos; as &quot;Block Time__(r)&quot;
from LOCKDURATION    
where State = &apos;BLOCKING&apos;
group by Lock
order by sum(duration) desc
  </query>
  <query id='ae2c5715-740e-4850-a404-38bdc8cde6b6' description='What locks are held during this field access?' revision='0' display='true'>SELECT O.THREADNAME &quot;Thread&quot;, A.TS &quot;Time&quot;, D.Lock &quot;Lock__|&quot;, LO.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, LO.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, S.AtLine &quot;Line__(r)&quot;, D.ID &quot;LDID__(hide)&quot;, A.TRACE &quot;ATRACE__(hide)&quot;,L.TRACE &quot;LATRACE__(hide)&quot;
 FROM ACCESS A
 INNER JOIN OBJECT O ON
   O.Id = A.InThread 
 INNER JOIN LOCKDURATION D ON
   D.InThread = A.InThread AND 
   (A.TS BETWEEN D.Start AND D.Stop)
 LEFT OUTER JOIN LOCK L ON
   L.Id = D.StartEvent
 LEFT OUTER JOIN TRACE TR ON
   TR.Id = L.TRACE
 LEFT OUTER JOIN SITE S ON
   S.Id = TR.SITE
 LEFT OUTER JOIN OBJECT LO ON
   LO.Id = S.InClass
WHERE 
   A.ID = ?AID?
ORDER BY O.THREADNAME ASC, A.TS ASC, D.Start DESC
</query>
  <query id='2611037a-f205-43d8-bd64-4da1e96f4807' description='What locks are held for each access of this field? ***' revision='3' display='true'>SELECT O.THREADNAME &quot;Thread&quot;,A.TS &quot;Time&quot;,D.Lock &quot;Lock__|&quot;,LO.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, LO.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, S.AtLine &quot;Line__(r)&quot;,D.ID &quot;LDID__(hide)&quot;,A.TRACE &quot;ATRACE__(hide)&quot;,L.TRACE &quot;LATRACE__(hide)&quot;
 FROM ACCESS A
 INNER JOIN OBJECT O ON
   O.Id = A.InThread 
 LEFT OUTER JOIN LOCKDURATION D --DERBY-PROPERTIES index=LOCKDURATION_TIME_INDEX
  ON 
   D.InThread = A.InThread AND 
   (A.TS BETWEEN D.Start AND D.Stop)
 LEFT OUTER JOIN LOCK L ON
   L.Id = D.StartEvent
 LEFT OUTER JOIN TRACE TR ON
   TR.Id = L.TRACE
 LEFT OUTER JOIN SITE S ON
   S.Id = TR.SITE
 LEFT OUTER JOIN OBJECT LO ON
   LO.Id = S.InClass
WHERE 
   A.FIELD = ?FieldId? AND 
   A.RECEIVER = ?Receiver? 
ORDER BY O.THREADNAME ASC, A.TS ASC, D.Start DESC</query>
  <query id='4ab4618a-c379-4099-b763-052b7ba269c5' description='What locks are held for each access of this field? ***' revision='3' display='true'>SELECT O.THREADNAME &quot;Thread&quot;,A.TS &quot;Time&quot;,D.Lock &quot;Lock__|&quot;,LO.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, LO.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, S.AtLine &quot;Line__(r)&quot;,D.ID &quot;LDID__(hide)&quot;,A.TRACE &quot;ATRACE__(hide)&quot;,L.TRACE &quot;LATRACE__(hide)&quot;
 FROM ACCESS A
 INNER JOIN OBJECT O ON
   O.Id = A.InThread 
 LEFT OUTER JOIN LOCKDURATION D --DERBY-PROPERTIES index=LOCKDURATION_TIME_INDEX
  ON 
   D.InThread = A.InThread AND 
   (A.TS BETWEEN D.Start AND D.Stop)
 LEFT OUTER JOIN LOCK L ON
   L.Id = D.StartEvent
 LEFT OUTER JOIN TRACE TR ON
   TR.Id = L.TRACE
 LEFT OUTER JOIN SITE S ON
   S.Id = TR.SITE
 LEFT OUTER JOIN OBJECT LO ON
   LO.Id = S.InClass
WHERE 
   A.FIELD = ?FieldId? AND 
   A.RECEIVER IS NULL
ORDER BY O.THREADNAME ASC, A.TS ASC, D.Start DESC</query>
  <query id='803ca72a-f303-4319-8a35-9494eccc3d26' description='What locks could potentially cause deadlock?' revision='0' display='true' display-at-root='true'>select Component &quot;Component&quot;, LockHeld &quot;LockHeld__(r)|&quot;,
  LockAcquired &quot;LockAcquired__(r)&quot;,
  Count &quot;Count__(r)&quot;, FirstTime &quot;FirstTime&quot;, LastTime &quot;LastTime&quot;
from lockcycle
where count &gt; 0
order by count desc</query>
  <query id='d5b7c435-3a93-46e1-98ec-e5c8289df564' description='What objects are threads?' revision='0' display='true'>select t.Id, t.ThreadName, cl.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
       cl.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;
from OBJECT as t, OBJECT as cl   
where t.ThreadName is not null
  and t.Type=cl.Id</query>
  <query id='ce90be0d-9d7a-49a6-8334-c6f37112fa4b' description='What threads read and write a field?' revision='3' display='true'>SELECT
  CO.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  CO.ClassName   &quot;Class__(&apos;class.gif&apos;)&quot;,
  F.FieldName    &quot;FieldName&quot;,
  THO.ThreadName &quot;Thread__|&quot;,
  FI.ReadCount &quot;Reads__(sum on 3)&quot;,
  FI.WriteCount &quot;Writes__(sum on 3)&quot;
 FROM FIELDSTATICTHREAD FI, OBJECT THO, FIELD F, OBJECT CO
 WHERE FI.FIELD = ?FieldId? AND 
   THO.ID = FI.THREAD AND 
   F.ID = FI.FIELD AND
   CO.ID = F.DECLARINGTYPE</query>
  <query id='598a178b-7153-4e1c-978e-1b78b1d95799' description='What threads read and write this field?' revision='3' display='true'>SELECT
  CO.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;,
  CO.ClassName   &quot;Class__(&apos;class.gif&apos;)&quot;,
  F.FieldName    &quot;FieldName&quot;,
  THO.ThreadName &quot;Thread__|&quot;,
  FI.ReadUCCount + FI.ReadCount &quot;Reads__(sum on 3)&quot;,
  FI.WriteUCCount + FI.WriteCount &quot;Writes__(sum on 3)&quot;,
  FI.ReadUCCount &quot;Reads During Construction__(sum on 3)&quot;,
  FI.WriteUCCount &quot;Writes During Construction__(sum on 3)&quot;
 FROM FIELDINSTANCETHREAD FI, OBJECT THO, FIELD F, OBJECT CO
 WHERE FI.FIELD = ?FieldId? AND 
   FI.RECEIVER = ?Receiver? AND 
   THO.ID = FI.THREAD AND 
   F.ID = FI.FIELD AND
   CO.ID = F.DECLARINGTYPE</query>
  <query id='be10177b-bce3-498c-ad83-c394d9264fc2' description='What threads use each lock?' revision='0' display='true'>select 
  L.LOCK &quot;Lock&quot;, 
  O.THREADNAME &quot;Thread Name__|&quot;,
  count(*) &quot;Acquisition Count&quot;
from LOCK L, OBJECT O
where L.INTHREAD = O.ID
  and L.STATE = &apos;AFTER ACQUISITION&apos;
group by l.lock, O.THREADNAME
order by 1, 2
</query>
  <query id='8034f80b-aefb-4255-98b6-0ccd73ab1696' description='When and by what threads was this field accessed?' revision='3' display='true'>SELECT &apos;?Package?&apos; &quot;Package__(&apos;package.gif&apos;)&quot;, &apos;?Class?&apos; &quot;Class__(&apos;class.gif&apos;)&quot;, &apos;?FieldName?&apos; &quot;FieldName__&quot;, 
       O.THREADNAME &quot;Thread__|&quot;, A.TS &quot;Time&quot;, A.ID &quot;AID__(hide)&quot;, A.TRACE &quot;ATRACE__(hide)&quot;
 FROM ACCESS A
 INNER JOIN OBJECT O ON
   O.Id = A.InThread 
WHERE 
   A.FIELD = ?FieldId? AND 
   A.RECEIVER = ?Receiver?
ORDER BY A.TS ASC</query>
  <query id='1fcd4578-f20e-4671-8f55-b6bec64f4249' description='When and by what threads was this field accessed?' revision='3' display='true'>SELECT &apos;?Package?&apos; &quot;Package__(&apos;package.gif&apos;)&quot;, &apos;?Class?&apos; &quot;Class__(&apos;class.gif&apos;)&quot;, &apos;?FieldName?&apos; &quot;FieldName__&quot;, 
       O.THREADNAME &quot;Thread__|&quot;, A.TS &quot;Time&quot;, A.ID &quot;AID__(hide)&quot;, A.TRACE &quot;ATRACE__(hide)&quot;
 FROM ACCESS A
 INNER JOIN OBJECT O ON
   O.Id = A.InThread 
WHERE 
   A.FIELD = ?FieldId? AND 
   A.RECEIVER IS NULL
ORDER BY A.TS ASC</query>
  <query id='67a08763-cefe-4193-908c-9dc8d1ca4245' description='When and where did this lock event occur?' revision='1' display='true'>select l.TS, t.ThreadName, l.Lock, lkType.ClassName as LockClass, 
l.LockIsThis as IsThis, l.LockIsClass as IsClass,
l.State, cl.PackageName, cl.ClassName, s.AtLine
from LOCK as l, TRACE tr, SITE s, OBJECT as cl, OBJECT as lk, OBJECT as t, OBJECT as lkType
where l.Id = ?LockEvent?
and tr.Id = l.Trace
and s.Id = tr.Site
and s.InClass = cl.Id
and l.Lock = lk.Id
and l.InThread = t.Id
and lk.Type = lkType.Id</query>
  <query id='330ba83b-9e6a-42d4-9eda-32f98f00a85f' description='When and where is this thread contending for that lock?' revision='0' display='true'>select ld.StartEvent as LockEvent,
   ld.Start,ld.Duration 
from LOCKDURATION AS ld, LOCK as le
where ld.State = &apos;BLOCKING&apos;
  and ld.Lock=?Lock?
  and ld.InThread=?InThread?
  and le.Id=ld.StartEvent
  and le.InClass=?InClass?
  and le.AtLine=?AtLine?
order by ld.Duration desc
  </query>
  <query id='9d05ac24-20c2-436e-af6b-2bd0bc7dbcfb' description='Where does a thread hold a lock and acquire another?' revision='0' display='true' display-at-root='true'>select count(LockHeld) &quot;Number of Locks Already Held&quot;,
  tho.ThreadName &quot;ThreadName&quot;, lo.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, lo.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, s.AtLine &quot;Line__(r)&quot;, lh.LockEvent &quot;LockEvent__(hide)&quot;, le.trace &quot;LETRACE__(hide)&quot;
from LOCKSHELD lh, LOCK le, TRACE tr, SITE s, OBJECT lo, OBJECT tho
where lh.LockEvent = le.Id
  and tr.Id = le.Trace
  and s.Id = tr.Site
  and lo.Id = s.InClass
  and tho.Id = le.InThread
group by lh.LockEvent, lo.ClassName, lo.PackageName, s.AtLine, tho.ThreadName, le.trace
order by 2 desc, 1

</query>
  <query id='c9453327-b892-4324-a6b8-2dceb32e1901' description='Which threads and what code are contending for a lock?' revision='0' display='true'>select lo.PackageName &quot;Package__(&apos;package.gif&apos;)&quot;, lo.ClassName &quot;Class__(&apos;class.gif&apos;)&quot;, s.AtLine &quot;Line__]&quot;,
  tho.ThreadName &quot;Thread__|&quot;, (trim(cast(sum(ld.Duration) as char(10))) || &apos; ns&apos;) &quot;BlockTime__(sum &apos; ns&apos;)(r)&quot;, le.trace &quot;LATRACE__(hide)&quot;
from LOCKDURATION ld, LOCK le, TRACE tr, SITE s, OBJECT lo, OBJECT tho
where ld.Lock=?Lock?
  and ld.State = &apos;BLOCKING&apos;
  and le.Id=ld.StartEvent
  and tr.Id = le.Trace
  and s.Id = tr.Site
  and lo.Id = s.InClass
  and tho.Id = ld.InThread
group by lo.PackageName,lo.ClassName, s.AtLine, tho.ThreadName, le.trace
order by lo.PackageName, lo.ClassName, s.AtLine, sum(ld.Duration) desc
  </query>
  <query id='5b6077b8-238e-44d7-baa8-3e3a09634c6d' description='Who is interacting with that lock at that moment?' revision='0' display='true'>select ld.InThread &quot;InThread&quot;, ld.State &quot;State&quot;, ld.Start &quot;Start&quot;, ld.Stop &quot;Stop&quot;, ld.Duration &quot;Duration&quot;, 
  ld.StartEvent &quot;LockEvent&quot;
from LOCK as le, LOCKDURATION AS ld
where le.Id=?LockEvent?
  and ld.Lock=?Lock?
  and le.ts between ld.Start and ld.Stop
order by ld.Start 
  </query>
  <sub-query id='4fce8390-7307-45dc-b779-5701ee7f23a1' sub-query='432b76db-c751-4bd8-8b2f-ef5986334514'/>
  <sub-query id='4fce8390-7307-45dc-b779-5701ee7f23a1' sub-query='fb317a0c-d9c5-41e2-811b-d6236f63fae1'/>
  <sub-query id='4fce8390-7307-45dc-b779-5701ee7f23a1' sub-query='67a08763-cefe-4193-908c-9dc8d1ca4245'/>
  <sub-query id='b82d393a-0d04-4daf-9716-1d88047e2585' sub-query='2611037a-f205-43d8-bd64-4da1e96f4807'/>
  <sub-query id='b82d393a-0d04-4daf-9716-1d88047e2585' sub-query='598a178b-7153-4e1c-978e-1b78b1d95799'/>
  <sub-query id='b82d393a-0d04-4daf-9716-1d88047e2585' sub-query='a1e89392-cd0c-4a41-85f1-44251d7a5e71'/>
  <sub-query id='b82d393a-0d04-4daf-9716-1d88047e2585' sub-query='8034f80b-aefb-4255-98b6-0ccd73ab1696'/>
  <sub-query id='adbe7424-776f-4903-86e2-a0f38f69c7f5' sub-query='2611037a-f205-43d8-bd64-4da1e96f4807'/>
  <sub-query id='adbe7424-776f-4903-86e2-a0f38f69c7f5' sub-query='598a178b-7153-4e1c-978e-1b78b1d95799'/>
  <sub-query id='adbe7424-776f-4903-86e2-a0f38f69c7f5' sub-query='a1e89392-cd0c-4a41-85f1-44251d7a5e71'/>
  <sub-query id='adbe7424-776f-4903-86e2-a0f38f69c7f5' sub-query='8034f80b-aefb-4255-98b6-0ccd73ab1696'/>
  <sub-query id='7eabaf47-9614-400f-bb4e-fd9e0f13e793' sub-query='2611037a-f205-43d8-bd64-4da1e96f4807'/>
  <sub-query id='7eabaf47-9614-400f-bb4e-fd9e0f13e793' sub-query='598a178b-7153-4e1c-978e-1b78b1d95799'/>
  <sub-query id='7eabaf47-9614-400f-bb4e-fd9e0f13e793' sub-query='a1e89392-cd0c-4a41-85f1-44251d7a5e71'/>
  <sub-query id='7eabaf47-9614-400f-bb4e-fd9e0f13e793' sub-query='8034f80b-aefb-4255-98b6-0ccd73ab1696'/>
  <sub-query id='419c927e-a87c-4364-b4a9-2e8f50f728f6' sub-query='ce90be0d-9d7a-49a6-8334-c6f37112fa4b'/>
  <sub-query id='419c927e-a87c-4364-b4a9-2e8f50f728f6' sub-query='6a39e6ca-29e9-4093-ba03-0e9bd9503a1a'/>
  <sub-query id='419c927e-a87c-4364-b4a9-2e8f50f728f6' sub-query='4ab4618a-c379-4099-b763-052b7ba269c5'/>
  <sub-query id='419c927e-a87c-4364-b4a9-2e8f50f728f6' sub-query='1fcd4578-f20e-4671-8f55-b6bec64f4249'/>
  <sub-query id='2f505921-50fb-405b-bc78-4a5fe9228957' sub-query='ce90be0d-9d7a-49a6-8334-c6f37112fa4b'/>
  <sub-query id='2f505921-50fb-405b-bc78-4a5fe9228957' sub-query='6a39e6ca-29e9-4093-ba03-0e9bd9503a1a'/>
  <sub-query id='2f505921-50fb-405b-bc78-4a5fe9228957' sub-query='4ab4618a-c379-4099-b763-052b7ba269c5'/>
  <sub-query id='2f505921-50fb-405b-bc78-4a5fe9228957' sub-query='1fcd4578-f20e-4671-8f55-b6bec64f4249'/>
  <sub-query id='c744b5b5-15f0-4f72-a344-7e52bcac5071' sub-query='ce90be0d-9d7a-49a6-8334-c6f37112fa4b'/>
  <sub-query id='c744b5b5-15f0-4f72-a344-7e52bcac5071' sub-query='6a39e6ca-29e9-4093-ba03-0e9bd9503a1a'/>
  <sub-query id='c744b5b5-15f0-4f72-a344-7e52bcac5071' sub-query='4ab4618a-c379-4099-b763-052b7ba269c5'/>
  <sub-query id='c744b5b5-15f0-4f72-a344-7e52bcac5071' sub-query='1fcd4578-f20e-4671-8f55-b6bec64f4249'/>
  <sub-query id='cb38a427-c259-4690-abe2-acea9661f737' sub-query='c9453327-b892-4324-a6b8-2dceb32e1901'/>
  <sub-query id='ae2c5715-740e-4850-a404-38bdc8cde6b6' sub-query='83d613b3-283e-4100-9a82-e42adf107fe6'/>
  <sub-query id='ae2c5715-740e-4850-a404-38bdc8cde6b6' sub-query='10477928-cf86-4416-9118-34eea8cd7e38'/>
  <sub-query id='2611037a-f205-43d8-bd64-4da1e96f4807' sub-query='83d613b3-283e-4100-9a82-e42adf107fe6'/>
  <sub-query id='2611037a-f205-43d8-bd64-4da1e96f4807' sub-query='10477928-cf86-4416-9118-34eea8cd7e38'/>
  <sub-query id='4ab4618a-c379-4099-b763-052b7ba269c5' sub-query='83d613b3-283e-4100-9a82-e42adf107fe6'/>
  <sub-query id='4ab4618a-c379-4099-b763-052b7ba269c5' sub-query='10477928-cf86-4416-9118-34eea8cd7e38'/>
  <sub-query id='803ca72a-f303-4319-8a35-9494eccc3d26' sub-query='4fce8390-7307-45dc-b779-5701ee7f23a1'/>
  <sub-query id='8034f80b-aefb-4255-98b6-0ccd73ab1696' sub-query='ae2c5715-740e-4850-a404-38bdc8cde6b6'/>
  <sub-query id='8034f80b-aefb-4255-98b6-0ccd73ab1696' sub-query='83d613b3-283e-4100-9a82-e42adf107fe6'/>
  <sub-query id='1fcd4578-f20e-4671-8f55-b6bec64f4249' sub-query='ae2c5715-740e-4850-a404-38bdc8cde6b6'/>
  <sub-query id='1fcd4578-f20e-4671-8f55-b6bec64f4249' sub-query='83d613b3-283e-4100-9a82-e42adf107fe6'/>
  <sub-query id='9d05ac24-20c2-436e-af6b-2bd0bc7dbcfb' sub-query='432b76db-c751-4bd8-8b2f-ef5986334514'/>
  <sub-query id='9d05ac24-20c2-436e-af6b-2bd0bc7dbcfb' sub-query='fb317a0c-d9c5-41e2-811b-d6236f63fae1'/>
  <sub-query id='c9453327-b892-4324-a6b8-2dceb32e1901' sub-query='10477928-cf86-4416-9118-34eea8cd7e38'/>
</ad-hoc>
